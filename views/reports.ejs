<%- include('partials/header') %>

<div class="container mt-5">
  <h2 class="mb-4">Learner Reports</h2>
  <p class="text-muted">Select a learner, term, and year to view or download their report card.</p>

  <!-- Term & Year Filter -->
  <div class="mb-4 d-flex">
    <div class="form-group mr-3">
      <label for="term">Term:</label>
      <select name="term" id="term" class="form-control">
        <option value="Term 1">Term 1</option>
        <option value="Term 2">Term 2</option>
        <option value="Term 3">Term 3</option>
      </select>
    </div>

    <div class="form-group mr-3">
      <label for="year">Year:</label>
      <select name="year" id="year" class="form-control">
        <% const currentYear = new Date().getFullYear(); %>
        <% for (let y = currentYear; y >= currentYear - 5; y--) { %>
          <option value="<%= y %>"><%= y %></option>
        <% } %>
      </select>
    </div>
  </div>

  <% if (learners && learners.length > 0) { %>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>#</th>
            <th>Admission No</th>
            <th>Full Name</th>
            <th>Class</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% learners.forEach((learner, index) => { %>
            <tr>
              <td><%= index + 1 %></td>
              <td><%= learner.adm_no %></td>
              <td><%= learner.full_name %></td>
              <td><%= learner.class %></td>
              <td>
                <button class="btn btn-sm btn-primary view-report" data-id="<%= learner.id %>">
                  <i class="bi bi-eye"></i> View
                </button>
                <button class="btn btn-sm btn-secondary pdf-report" data-id="<%= learner.id %>">
                  <i class="bi bi-file-earmark-pdf"></i> PDF
                </button>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  <% } else { %>
    <div class="alert alert-info mt-3">No learners found.</div>
  <% } %>
</div>

<script>
document.querySelectorAll('.view-report').forEach(btn => {
  btn.addEventListener('click', () => {
    const studentId = btn.getAttribute('data-id');
    const term = document.getElementById('term').value;
    const year = document.getElementById('year').value;
    window.location.href = `/reports/view/${studentId}/${term}/${year}`;
  });
});

document.querySelectorAll('.pdf-report').forEach(btn => {
  btn.addEventListener('click', () => {
    const studentId = btn.getAttribute('data-id');
    const term = document.getElementById('term').value;
    const year = document.getElementById('year').value;
    window.location.href = `/reports/pdf/${studentId}/${term}/${year}`;
  });
});
</script>

<%- include('partials/footer') %>
